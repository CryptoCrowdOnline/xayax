// Copyright (C) 2021 The Xaya developers
// Distributed under the MIT software license, see the accompanying
// file COPYING or http://www.opensource.org/licenses/mit-license.php.

#include "abi.hpp"

#include <gtest/gtest.h>

namespace xayax
{
namespace
{

using AbiTests = testing::Test;

TEST_F (AbiTests, ParseInt)
{
  EXPECT_EQ (AbiDecoder::ParseInt ("1234"), 1234);
  EXPECT_EQ (AbiDecoder::ParseInt ("0x0000"), 0);
  EXPECT_EQ (AbiDecoder::ParseInt ("0000"), 0);
  EXPECT_EQ (AbiDecoder::ParseInt ("0xffaa2"), 0xFFAA2);
  EXPECT_EQ (AbiDecoder::ParseInt ("0x00001234"), 0x1234);
}

TEST_F (AbiTests, DecodeMoveEvent)
{
  /* This is real event data from a move transaction on the Mumbai testnet:
     0x9bafd026d0badd9518d497dde95172ae306848790348de95e2928aecbcfda72d  */
  AbiDecoder dec("0x"
      "00000000000000000000000000000000000000000000000000000000000000e0"
      "0000000000000000000000000000000000000000000000000000000000000120"
      "0000000000000000000000000000000000000000000000000000000000000160"
      "0000000000000000000000000000000000000000000000000000000000000002"
      "00000000000000000000000014e663e1531e0f438840952d18720c74c28d4f20"
      "00000000000000000000000000000000000000000000000000000000000004d2"
      "000000000000000000000000f0534cc8f4c22972d31105c7ac7b656b581a3a8e"
      "0000000000000000000000000000000000000000000000000000000000000001"
      "7000000000000000000000000000000000000000000000000000000000000000"
      "0000000000000000000000000000000000000000000000000000000000000005"
      "646f6d6f62000000000000000000000000000000000000000000000000000000"
      "0000000000000000000000000000000000000000000000000000000000000002"
      "7b7d000000000000000000000000000000000000000000000000000000000000");

  ASSERT_EQ (dec.ReadString (), "p");
  ASSERT_EQ (dec.ReadString (), "domob");
  ASSERT_EQ (dec.ReadString (), "{}");
  ASSERT_EQ (AbiDecoder::ParseInt (dec.ReadUint (256)), 2);
  ASSERT_EQ (dec.ReadUint (160), "0x14e663e1531e0f438840952d18720c74c28d4f20");
  ASSERT_EQ (AbiDecoder::ParseInt (dec.ReadUint (256)), 1234);
  ASSERT_EQ (dec.ReadUint (160), "0xf0534cc8f4c22972d31105c7ac7b656b581a3a8e");
}

} // anonymous namespace
} // namespace xayax
